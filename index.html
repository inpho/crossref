<!DOCTYPE html>
<html lang="en">
<head>
  <title>CrossRef Rewrite</title>
  <!-- Stylesheet Imports -->
  <link rel="stylesheet" href="lib/css/bootstrap.min.css" />

  <!-- Javascript Imports -->
  <script src="lib/js/jquery-1.10.2.min.js" type="text/javascript"></script>
  <script src="lib/js/bootstrap.min.js" type="text/javascript"></script>
  <script src="lib/js/mustache.js" type="text/javascript"></script>
</head>

<body>

    <script type="text/javascript">
        //Function: inpho_get 
        //Notes: makes API call to retrieve entities that have a matching SEP entry
        //Returns: Array of results in single json entry
        //desired json return array ????
        /*
        {
            "occurrences": "",
            "hyponyms": "",
            "user evaluations": "",
            "related terms": "",
            "first-order rel": "", 
            }
        */
        var host;
        var json_array; 
        
        function inpho_get(url) {
            host = "https://inpho.cogs.indiana.edu"; 
            var json_array = [];  //empty array to store returned entities 
            
            for(i = 0; length = url.length; i < length; i++){
            
            $.ajax({
                type: 'GET',
                dataType: "json",
                url: host,
                data: url[i],
                success:function(jsonData){ //going to be similar to process_relation, can just use process_relation, jquery.each method (pass list of urls aka similar to map) "at the same time - nonblocking"
                  
                    for(var i = 0, length < jsonData.items.length; i<length; i++){
                        json_array.push(jsonData.items[i]);
                    }
                }
                
            })
            }
        }
         //Function name: get_SEPArray 
         //Notes: makes API call to retrieve all SEP entires in the InPho database
         //Returns: returns array of all entries in SEP
        
        function get_SEPArray(){
            var sep_array = [];
            
            $.each(inpho_get('/entity.json?sep_filter=True'), function(concept)) {
                if(data != "") {
                    sep_array = sep_array.concat(',', '\'', concept, sep_dir, '\'');
                }
            }
            return sep_array; 
        }
        
       function draw_query() {
        document.write('<script language="javascript" type="text/javascript" src="actb.js" charset="UTF-8"></script>');
        document.write('<script language="javascript" type="text/javascript" src="common.js" charset="UTF-8"></script>');
        document.write('<script language="javascript">');
        document.write('window.onload = function() {');
        document.write("document.getElementById('query').setAttribute('autocomplete', 'off');");
        document.write("};");
        document.write('var aSEP = new Array('.getSEPArray().');');
        document.write('</script>');
        document.write('<form action="crossref.php" method="get">');
        document.write('SEP canonical directory: <input type="text" name="query" id="query" value="');
        if(isset($sep_dir)) echo $sep_dir;
        echo '">';
        echo '<script>var obj = actb(document.getElementById(\'query\'),aSEP);</script>';
        echo '<input type="submit" value="Edit references">';
        echo '</form>';
        for ($i=0; $i<5; $i++) { echo "<br />"; }
    }
        
        
        /*Function: idea  */
        
        function idea(id){
            idea_sources = ["/idea/$id/occurrences.json?sep_filter=True", "/idea/$id/related.json?sep_filter=True","/idea/$id/hyponyms.json?sep_filter=True", "/idea/$id/evaluated.json?sep_filter=True", "/idea/$id/first_order.json?sep_filter=True"]
            
            inpho_get(idea_sources);
        }
        
        /*Function: idea_thinker  */
        
        function idea_thinker(id){
            idea_thinker_sources = ["/idea/$id/thinker_occurrences.json?sep_filter=True", "/idea/$id/related_thinkers.json?sep_filter=True"]
            
            inpho_get(idea_thinker_sources);
        }
        
        /*Function: thinker_idea  */
        
        function thinker_idea(id){
            thinker_idea_sources = ["/thinker/$id/idea_occurrences.json?sep_filter=True", "/thinker/$id/related_ideas.json?sep_filter=True"]
            
            inpho_get(thinker_idea_sources);
        }
        
        /*Function: thinker  */
        
        function thinker(id){
            thinker_sources = thinker = ["/thinker/$id/occurrences.json?sep_filter=True", "/thinker/$id/related.json?sep_filter=True", "/thinker/$id/hyponyms.json?sep_filter=True", "/thinker/$id/influenced.json?sep_filter=True"]
            
            inpho_get(thinker_sources);
        }
       
    </script>

</body>
</html>
